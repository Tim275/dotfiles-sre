# =============================================================================
# TMUX Configuration (radleylewis Tutorial)
# =============================================================================

# Enable Colours
set -g default-terminal 'xterm-256color'
set -as terminal-overrides ',xterm*:Tc:sitm=\E[3m'

# Prefix Key
set -g prefix C-a
unbind C-b
bind-key C-a send-prefix

# Open new windows in current directory path
bind c new-window -c "#{pane_current_path}"

# Split Windows (einfache Tasten!)
unbind %
unbind '"'
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"   # Ctrl+a v = vertikal (links/rechts)
bind s split-window -v -c "#{pane_current_path}"   # Ctrl+a s = split (oben/unten)

# Reload Config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "󰑓 Config reloaded"

# Resize Panes
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5
bind -r m resize-pane -Z

# Enable Mouse
set -g mouse on

# Scrollback
set -g history-limit 50000

# VIM motions
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection

# Enable Mouse Dragging
unbind -T copy-mode-vi MouseDragEnd1Pane

# Status Line Position
set-option -g status-position top

# =============================================================================
# Plugins - Core
# =============================================================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'

# =============================================================================
# Plugins - Productivity (NEU!)
# =============================================================================
set -g @plugin 'sainnhe/tmux-fzf'              # Ctrl+a F = Fuzzy-Suche für alles
set -g @plugin 'tmux-plugins/tmux-open'        # o = URL öffnen, Ctrl+o = Editor
set -g @plugin 'Morantron/tmux-fingers'        # Ctrl+a f = Copy wie Vimium
set -g @plugin 'laktak/extrakto'               # Ctrl+a e = Fuzzy Text aus Terminal
set -g @plugin 'wfxr/tmux-fzf-url'             # Ctrl+a u = URLs fuzzy finden

# =============================================================================
# Plugins - System Monitoring
# =============================================================================
set -g @plugin 'tmux-plugins/tmux-cpu'         # CPU/RAM Anzeige
set -g @plugin 'tmux-plugins/tmux-battery'     # Akku Anzeige

# =============================================================================
# Plugins - DevOps Extras
# =============================================================================
set -g @plugin 'tmux-plugins/tmux-sidebar'     # Ctrl+a Tab = Datei-Sidebar
set -g @plugin 'tmux-plugins/tmux-logging'     # Ctrl+a P = Pane Logging
set -g @plugin 'omerxx/tmux-sessionx'          # Ctrl+a o = Session Manager Pro
set -g @plugin 'tmux-plugins/tmux-sessionist'  # Session Utils
set -g @plugin 'tmux-plugins/tmux-copycat'     # Regex Search in Copy-Mode

# =============================================================================
# Theme: Duskfox (passend zu Neovim!)
# =============================================================================
set -g status-style bg='#191726',fg='#cdcbe0'
set -g message-style bg='#232136',fg='#cdcbe0'
set -g pane-border-style fg='#393552'
set -g pane-active-border-style fg='#569fba'
set -g mode-style bg='#cdcbe0',fg='#191726'

set -g status-left-length 60
set -g status-left "#[fg=#569fba,bg=#191726]#[fg=#191726,bg=#569fba,bold] #S  #[fg=#569fba,bg=#191726]"

set -g status-right-length 200
set -g status-right "#[fg=#569fba]#{battery_icon} #{battery_percentage} #[fg=#6e6a86]│ #[fg=#ea9a97]󰍛 #{cpu_percentage} #[fg=#6e6a86]│ #[fg=#cdcbe0]󰥔 %H:%M #[fg=#6e6a86]│ #[fg=#908caa]󰃭 %d.%m #[fg=#6e6a86]│ #[fg=#ea9a97]󰅒 #H "

set -g window-status-format "#[fg=#6e6a86] 󰈚 #I:#W "
set -g window-status-current-format "#[fg=#cdcbe0,bg=#393552,bold] 󰈚 #I:#W #[default]"
set -g window-status-separator ""

# =============================================================================
# Auto Save / Restore
# =============================================================================
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '1'

# =============================================================================
# Plugin Settings
# =============================================================================
# tmux-fzf
set -g @tmux-fzf-launch-key 'F'               # Ctrl+a F = Fuzzy Menu
TMUX_FZF_PREVIEW=0

# tmux-fingers
set -g @fingers-key 'f'                        # Ctrl+a f = Finger Mode

# extrakto
set -g @extrakto_key 'e'                       # Ctrl+a e = Extract Text

# tmux-fzf-url
set -g @fzf-url-bind 'u'                       # Ctrl+a u = URLs

# tmux-sidebar
set -g @sidebar-tree-command 'ls -1a'
set -g @sidebar-tree-position 'left'
set -g @sidebar-tree-width '30'

# tmux-logging
set -g @logging-path '~/.tmux/logs'
set -g @screen-capture-path '~/.tmux/logs'

# tmux-sessionx (Session Manager Pro)
set -g @sessionx-bind 'o'                      # Ctrl+a o = SessionX
set -g @sessionx-preview-enabled 'true'
set -g @sessionx-window-mode 'on'
set -g @sessionx-zoxide-mode 'on'

# tmux-sessionist
# Ctrl+a g = Session wechseln mit Autocomplete
# Ctrl+a C = Neue Session erstellen
# Ctrl+a X = Session killen
# Ctrl+a S = Letzte Session

# tmux-copycat (Regex Search)
# Ctrl+a / = Regex Suche
# Ctrl+a Ctrl+f = File Suche
# Ctrl+a Ctrl+u = URL Suche
# Ctrl+a Ctrl+d = Digits Suche
# n/N = Next/Previous Match

# tmux-cpu
set -g @cpu_percentage_format '%3.0f%%'

# tmux-battery
set -g @batt_icon_charge_tier8 ''
set -g @batt_icon_charge_tier7 ''
set -g @batt_icon_charge_tier6 ''
set -g @batt_icon_charge_tier5 ''
set -g @batt_icon_charge_tier4 ''
set -g @batt_icon_charge_tier3 ''
set -g @batt_icon_charge_tier2 ''
set -g @batt_icon_charge_tier1 ''
set -g @batt_icon_status_charged ''
set -g @batt_icon_status_charging ''

# =============================================================================
# Neovim CheckHealth Recommendations
# =============================================================================
set-option -sg escape-time 10
set-option -g focus-events on

# =============================================================================
# Advanced Settings (Power User!)
# =============================================================================
# Aggressive resize (nur aktives Window resizen, nicht alle)
set-option -g aggressive-resize on

# Activity Monitoring (zeigt Aktivität in anderen Windows)
set-option -g monitor-activity on
set-option -g visual-activity off

# Automatisches Window Renaming
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# Bessere Window/Pane Indexierung
set-option -g base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Display Zeit für Pane-Nummern
set-option -g display-panes-time 2000
set-option -g display-time 2000

# =============================================================================
# ROOT Keybindings (OHNE Prefix! Schneller!)
# =============================================================================
# Alt+Zahl = Window wechseln (ohne Prefix!)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# Alt+h/l = Window wechseln
bind -n M-h previous-window
bind -n M-l next-window

# Alt+n = Neues Window
bind -n M-n new-window -c "#{pane_current_path}"

# Alt+w = Window schließen
bind -n M-w kill-window

# Shift+Pfeiltasten = Pane resizen (ohne Prefix!)
bind -n S-Left resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Up resize-pane -U 1
bind -n S-Down resize-pane -D 1

# =============================================================================
# Better Copy Mode
# =============================================================================
# Clipboard Integration (macOS)
set-option -g set-clipboard on

# Copy Mode Verbesserungen
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind-key -T copy-mode-vi 'H' send -X start-of-line
bind-key -T copy-mode-vi 'L' send -X end-of-line

# Double-Click = Wort kopieren
bind-key -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word
bind-key -n DoubleClick1Pane select-pane \; copy-mode -M \; send -X select-word

# Triple-Click = Zeile kopieren
bind-key -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line
bind-key -n TripleClick1Pane select-pane \; copy-mode -M \; send -X select-line

# =============================================================================
# Session Navigation
# =============================================================================
bind w choose-tree -Zs                    # Ctrl+a w = Tree-Ansicht (wie im Tutorial)
bind W display-popup -E -w 30% -h 50% ~/.config/tmux/scripts/tmux-menu.sh  # Ctrl+a W = fzf Menu

# =============================================================================
# Pop-Up: Scratch Pad (Prefix + T)
# =============================================================================
unbind -T popup Tab
bind T display-popup -E -w 80% -h 80% ~/.config/tmux/scripts/tmux-scratch.sh
bind -T popup t send-keys t
bind -T popup q send-keys q
bind -T popup T detach
bind -T popup C-[ copy-mode

# =============================================================================
# Pop-Up: LazyGit (Prefix + g)
# =============================================================================
bind g display-popup -d "#{pane_current_path}" -E -w 80% -h 80% -E lazygit

# =============================================================================
# Pop-Up: Help (Prefix + ?)
# =============================================================================
bind ? display-popup -E -w 70% -h 80% ~/.config/tmux/scripts/tmux-help.sh

# =============================================================================
# Pop-Up: Claude Code (Prefix + a)
# =============================================================================
bind a display-popup -d "#{pane_current_path}" -E -w 90% -h 90% claude

# =============================================================================
# Startup Message
# =============================================================================
set -g @resurrect-hook-post-restore-all 'tmux display-message "  TMUX restored!"'

# =============================================================================
# TPM Init (MUSS am Ende sein!)
# =============================================================================
run '~/.tmux/plugins/tpm/tpm'

# Startup Nachricht (nach TPM!)
run-shell 'tmux display-message "  TMUX | Ctrl+a ? = Hilfe | v/s = Split | g = Git"'
